\RequirePackage{tikz, datetime}
%\RequirePackage[showboxes]{textpos} % for debugging textblock
\RequirePackage{textpos}

\mode<presentation>

% Backgrounds
\setbeamertemplate{background}{
  \ifnum\thepage=1\relax
    \includegraphics[width=\paperwidth]{Modello_CMCC_slide_Layout_Cover.pdf};
  \else
    \ifnum\thepage=\ztotpages-1
      ~
    \else
      \includegraphics[width=\paperwidth]{Modello_CMCC_slide_Layout_header.png};
    \fi
  \fi
}

% Title page
\setbeamertemplate{title page}{
  \setcounter{framenumber}{0}
  \begin{textblock*}{9cm}[0,1](2.5cm, 3cm)
    \begin{beamercolorbox}[wd=8cm]{title page header}
      \usebeamerfont{title}\usebeamercolor{title}\inserttitle%
    \end{beamercolorbox}%
    \vspace{1em}
    \begin{beamercolorbox}{author}
      \usebeamerfont{author}\insertauthor \\
	            {\hypersetup{urlcolor=white} \texttt{\href{mailto:\@email}{\@email}}}
    \end{beamercolorbox}
    \vspace{1em}
    \begin{beamercolorbox}{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}
  \end{textblock*}
}

% End page
\AtEndDocument{\includepdf[pages=-]{Modello_CMCC_slide_Layout_last.pdf}}

% Bullets as squares
\setbeamertemplate{items}[square]
\setbeamertemplate{sections/subsections in toc}[square]

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{items}[square]
% \setbeamertemplate{itemize item}{\tikz{\draw[color=ScratchBrown, semithick] rectangle(.2,.2);}}
% \setbeamertemplate{itemize subitem}{\tikz{\draw[color=ScratchOrange, ultra thick] rectangle(.2,.2);}}
% \setbeamertemplate{itemize subsubitem}{\tikz{\draw[color=ScratchLightOrange] rectangle(.2,.2);}}

\defbeamertemplate*{itemize item}{ScratchBrown}{$\bullet$}
\defbeamertemplate*{itemize subitem}{ScratchBrown}{\---}
\defbeamertemplate*{itemize subsubitem}{ScratchBrown}{\guillemotright}

\setbeamertemplate{enumerate items}[default]

\setbeamertemplate{sections/subsections in toc}[square]

\setbeamertemplate{bibliography item}[text]

% Footer
\defbeamertemplate*{footline}{fibeamer}{%
    \ifnum\c@framenumber=0\else%
      \begin{tikzpicture}[overlay]
        \node[anchor=south east,
          yshift=0.1cm,
          xshift=-0.1cm] at
          (current page.south east) {
            \usebeamercolor[fg]{framenumber}%
            \usebeamerfont{framenumber}%
            \insertframenumber/\inserttotalframenumber};
      \end{tikzpicture}
    \fi}

\mode<all>
