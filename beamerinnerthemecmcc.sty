\RequirePackage{tikz, datetime}
%\RequirePackage[showboxes]{textpos} % for debugging textblock
\RequirePackage{textpos}

\mode<presentation>

% Backgrounds
\setbeamertemplate{background}{
  \ifnum\thepage=1\relax
    \includegraphics[width=\paperwidth]{resources/Modello_CMCC_slide_Layout_cover.pdf};
  \else
    \ifnum\thepage=\ztotpages-1
      ~
    \else
      \includegraphics[width=\paperwidth]{resources/Modello_CMCC_slide_Layout_header.png};
    \fi
  \fi
}

% Title page
\setbeamertemplate{title page}{
  \setcounter{framenumber}{0}
  \begin{textblock*}{12cm}[0,1](2.0cm, 3cm)
    \begin{beamercolorbox}{title page header}
      \usebeamerfont{title}\usebeamercolor{title}\inserttitle%
    \end{beamercolorbox}%
    \vspace{1em}
    \begin{beamercolorbox}{author}
      \usebeamerfont{author}\insertauthor \\
	            {\hypersetup{urlcolor=white} \texttt{\href{mailto:\@email}{\@email}}}
    \end{beamercolorbox}
    \vspace{1em}
    \begin{beamercolorbox}{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}
  \end{textblock*}
}

% End page
\AtEndDocument{\includepdf[pages=-]{resources/Modello_CMCC_slide_Layout_last.pdf}}

% Font
\setbeamerfont{normal text}{size=\small}
\AtBeginDocument{\usebeamerfont{normal text}}

% Bullets as squares
\setbeamertemplate{sections/subsections in toc}[square]

\setbeamertemplate{navigation symbols}{}

\defbeamertemplate*{itemize item}{ScratchBrown}{$\bullet$}
\defbeamertemplate*{itemize subitem}{ScratchBrown}{\guillemotright}
\defbeamertemplate*{itemize subsubitem}{ScratchBrown}{\---}

\setbeamertemplate{section in toc}{\inserttocsection}

\setbeamertemplate{bibliography item}[text]

% Footer
\defbeamertemplate*{footline}{fibeamer}{%
    \ifnum\c@framenumber=0\else%
      \begin{tikzpicture}[overlay]
        \node[anchor=south east,
          yshift=0.1cm,
          xshift=-0.1cm] at
          (current page.south east) {
            \usebeamercolor[fg]{framenumber}%
            \usebeamerfont{framenumber}%
            \insertframenumber/\inserttotalframenumber};
      \end{tikzpicture}
    \fi}

\mode<all>
