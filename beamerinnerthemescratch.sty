\RequirePackage{tikz, datetime}
%\RequirePackage[showboxes]{textpos} % for debugging textblock
\RequirePackage{textpos}

\mode<presentation>

% Backgrounds
\setbeamertemplate{background}{
    \begin{tikzpicture}
        \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
        \fill[color=ScratchBrown] (0,2) rectangle (\the\paperwidth,\the\paperheight);
        \fill[color=ScratchOrange] (0.1,0.1) rectangle(2.95,1.9);
        \fill[color=ScratchLightBlue] (3.05,0.1) rectangle(\the\paperwidth-3.1,1.9);
        \ifnum\thepage>1\relax%
            \fill[white,opacity=1] (0,0) rectangle(\the\paperwidth,\the\paperheight);
        \fi
    \end{tikzpicture}
}

% Title page
\setbeamertemplate{title page}{
    \setcounter{framenumber}{0}
	\begin{textblock*}{9cm}[0,1](2.5cm, 3cm)
    \begin{beamercolorbox}[wd=8cm]{title page header}
      \usebeamerfont{title}\usebeamercolor{title}\inserttitle%
    \end{beamercolorbox}%
    \vspace{1em}
	\begin{beamercolorbox}{author}
	      \usebeamerfont{author}\insertauthor \\
	      {\hypersetup{urlcolor=white} \texttt{\href{mailto:\@email}{\@email}}}
    	\end{beamercolorbox}
    \end{textblock*}

    \ifx\insertinstitute\@empty%
        {
        \begin{textblock*}{9cm}(2.5cm, 4.6cm)
    		\begin{beamercolorbox}{date}
    	      \usebeamerfont{date}\insertdate
    	    \end{beamercolorbox}
        \end{textblock*} 
        }
        \else%
        {
        \begin{textblock*}{9cm}(2.5cm, 4.4cm)
    		\begin{beamercolorbox}{date}
    	      \usebeamerfont{date}\insertdate \\
    	      \insertinstitute
    	    \end{beamercolorbox}
        \end{textblock*} 
        }%
    \fi
}

% Bullets as squares
\setbeamertemplate{items}[square]
\setbeamertemplate{sections/subsections in toc}[square]

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{items}[square]
% \setbeamertemplate{itemize item}{\tikz{\draw[color=ScratchBrown, semithick] rectangle(.2,.2);}}
% \setbeamertemplate{itemize subitem}{\tikz{\draw[color=ScratchOrange, ultra thick] rectangle(.2,.2);}}
% \setbeamertemplate{itemize subsubitem}{\tikz{\draw[color=ScratchLightOrange] rectangle(.2,.2);}}

\defbeamertemplate*{itemize item}{ScratchBrown}{$\bullet$}
\defbeamertemplate*{itemize subitem}{ScratchBrown}{\---}
\defbeamertemplate*{itemize subsubitem}{ScratchBrown}{\guillemotright}

\setbeamertemplate{enumerate items}[default]

\setbeamertemplate{sections/subsections in toc}[square]

\setbeamertemplate{bibliography item}[text]

% Footer
\defbeamertemplate*{footline}{fibeamer}{%
    \ifnum\c@framenumber=0\else%
      \begin{tikzpicture}[overlay]
        \node[anchor=south east,
          yshift=0.1cm,
          xshift=-0.1cm] at
          (current page.south east) {
            \usebeamercolor[fg]{framenumber}%
            \usebeamerfont{framenumber}%
            \insertframenumber/\inserttotalframenumber};
      \end{tikzpicture}
    \fi}

\mode<all>